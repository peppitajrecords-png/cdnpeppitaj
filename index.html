<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>CDN Image</title>
<style>
    body, html {
        margin: 0;
        padding: 0;
        width: 1640px;
        height: 664px;
        overflow: hidden;
    }
    #canvas {
        display: block;
    }
</style>
</head>
<body>
<canvas id="canvas" width="1640" height="664"></canvas>

<script>
(async () => {
    const urlParams = new URLSearchParams(window.location.search);
    const imgUrl = urlParams.get('img');
    const text = urlParams.get('text') || '';

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // Fondo blanco
    ctx.fillStyle = '#000'; // Cambia a blanco si quieres
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Cargar imagen
    if (imgUrl) {
        const img = new Image();
        img.crossOrigin = 'anonymous'; // Importante para evitar problemas CORS
        img.src = imgUrl;
        await new Promise((res, rej) => {
            img.onload = res;
            img.onerror = rej;
        });

        // Dibuja la imagen en el centro con borde circular
        const size = 400;
        const x = canvas.width / 2 - size / 2;
        const y = canvas.height / 2 - size / 2;

        ctx.save();
        ctx.beginPath();
        ctx.arc(canvas.width / 2, canvas.height / 2, size / 2, 0, Math.PI * 2);
        ctx.closePath();
        ctx.clip();
        ctx.drawImage(img, x, y, size, size);
        ctx.restore();
    }

    // Agregar texto
    ctx.fillStyle = 'white';
    ctx.font = 'bold 60px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(text, canvas.width / 2, canvas.height - 50);

    // Convertir canvas a imagen descargable
    const dataUrl = canvas.toDataURL('image/png');

    // Si quieres que se vea como imagen directamente en el navegador:
    document.body.innerHTML = `<img src="${dataUrl}" width="1640" height="664">`;
})();
</script>
</body>
</html>
